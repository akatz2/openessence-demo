(function(){var d,E,F,s,A,G,H,I,B,J,K,t,u,C,D,w,x=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},r={}.hasOwnProperty,v=function(a,b){return function(){return a.apply(b,arguments)}};d=jQuery;F=function(a){var b,c;b=(a+"").split(".");a=b[0];c=1<b.length?"."+b[1]:"";for(b=/(\d+)(\d{3})/;b.test(a);)a=a.replace(b,"$1,$2");return a+c};t=function(a,b){null==a&&(a=3);null==b&&(b=1);return function(c){return 0===c||isNaN(c)||!isFinite(c)?"":F((b*c).toFixed(a))}};
s={sum:function(a,b){null==a&&(a=3);null==b&&(b=1);return function(c){var e;e=c[0];return function(){return{sum:0,push:function(b){if(!isNaN(parseFloat(b[e])))return this.sum+=parseFloat(b[e])},value:function(){return this.sum},format:t(a,b),label:"Sum of "+e}}}},average:function(a,b){null==a&&(a=3);null==b&&(b=1);return function(c){var e;e=c[0];return function(){return{sum:0,len:0,push:function(b){if(!isNaN(parseFloat(b[e])))return this.sum+=parseFloat(b[e]),this.len++},value:function(){return this.sum/
this.len},format:t(a,b),label:"Average of "+e}}}},sumOverSum:function(a,b){null==a&&(a=3);null==b&&(b=1);return function(c){var e,h;h=c[0];e=c[1];return function(){return{sumNum:0,sumDenom:0,push:function(b){isNaN(parseFloat(b[h]))||(this.sumNum+=parseFloat(b[h]));if(!isNaN(parseFloat(b[e])))return this.sumDenom+=parseFloat(b[e])},value:function(){return this.sumNum/this.sumDenom},format:t(a,b),label:""+h+"/"+e}}}},sumOverSumBound80:function(a,b,c){null==a&&(a=3);null==b&&(b=1);null==c&&(c=!0);return function(e){var h,
f;f=e[0];h=e[1];return function(){return{sumNum:0,sumDenom:0,push:function(b){isNaN(parseFloat(b[f]))||(this.sumNum+=parseFloat(b[f]));if(!isNaN(parseFloat(b[h])))return this.sumDenom+=parseFloat(b[h])},value:function(){return(0.821187207574908/this.sumDenom+this.sumNum/this.sumDenom+1.2815515655446004*(c?1:-1)*Math.sqrt(0.410593603787454/(this.sumDenom*this.sumDenom)+this.sumNum*(1-this.sumNum/this.sumDenom)/(this.sumDenom*this.sumDenom)))/(1+1.642374415149816/this.sumDenom)},format:t(a,b),label:""+
(c?"Upper":"Lower")+" Bound of "+f+"/"+h}}}}};A={count:function(){return function(){return{count:0,push:function(){return this.count++},value:function(){return this.count},format:t(0),label:"Count"}}},countUnique:function(a){var b;b=a[0];return function(){return{uniq:[],push:function(c){var a;if(a=c[b],0>x.call(this.uniq,a))return this.uniq.push(c[b])},value:function(){return this.uniq.length},format:t(0),label:"Count Unique "+b}}},listUnique:function(a){var b;b=a[0];return function(){return{uniq:[],
push:function(c){var a;if(a=c[b],0>x.call(this.uniq,a))return this.uniq.push(c[b])},value:function(){return this.uniq.join(", ")},format:function(b){return b},label:"List Unique "+b}}},intSum:s.sum(0),sum:s.sum(3),average:s.average(3),sumOverSum:s.sumOverSum(3),ub80:s.sumOverSumBound80(3,1,!0),lb80:s.sumOverSumBound80(3,1,!1)};C={Table:function(a){return u(a)},"Table Barchart":function(a){return u(a).barchart()},Heatmap:function(a){return u(a).heatmap()},"Row Heatmap":function(a){return u(a).heatmap("rowheatmap")},
"Col Heatmap":function(a){return u(a).heatmap("colheatmap")}};K="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");H="Sun Mon Tue Wed Thu Fri Sat".split(" ");w=function(a){return("0"+a).substr(-2,2)};d.pivotUtilities={aggregatorTemplates:s,aggregators:A,renderers:C,derivers:{bin:function(a,b){return function(c){return c[a]-c[a]%b}},dateFormat:function(a,b){return function(c){var e;e=new Date(Date.parse(c[a]));return b.replace(/%(.)/g,function(b,a){switch(a){case "y":return e.getFullYear();
case "m":return w(e.getMonth()+1);case "n":return K[e.getMonth()];case "d":return w(e.getDate());case "w":return H[e.getDay()];case "x":return e.getDay();case "H":return w(e.getHours());case "M":return w(e.getMinutes());case "S":return w(e.getSeconds());default:return"%"+a}})}}}};I=function(a,b,c){var e,h,f;for(e in b)h=b[e],a[e]=null!=(f=h(a))?f:a[e];for(e in a)r.call(a,e)&&null==a[e]&&(a[e]="null");return c(a)};B=function(a,b,c){var e,h,f,k,p,l,n,g,m;e=function(a){return I(a,b,c)};if("[object Function]"===
Object.prototype.toString.call(a))return a(e);if(Array.isArray(a)){if(Array.isArray(a[0])){m=[];for(f in a)if(r.call(a,f)&&(h=a[f],0<f)){l={};g=a[0];for(k in g)r.call(g,k)&&(p=g[k],l[p]=h[k]);m.push(e(l))}return m}k=[];h=0;for(f=a.length;h<f;h++)l=a[h],k.push(e(l));return k}n=[];d("thead > tr > th",a).each(function(b){return n.push(d(this).text())});return d("tbody > tr",a).each(function(b){l={};d("td",this).each(function(b){return l[n[b]]=d(this).text()});return e(l)})};G=function(a){var b;b=[];
B(a,{},function(a){return b.push(a)});return b};E=function(){function a(b,a,e){this.aggregator=b;this.colAttrs=a;this.rowAttrs=e;this.getAggregator=v(this.getAggregator,this);this.flattenKey=v(this.flattenKey,this);this.getRowKeys=v(this.getRowKeys,this);this.getColKeys=v(this.getColKeys,this);this.sortKeys=v(this.sortKeys,this);this.arrSort=v(this.arrSort,this);this.natSort=v(this.natSort,this);this.tree={};this.rowKeys=[];this.colKeys=[];this.flatRowKeys=[];this.flatColKeys=[];this.rowTotals={};
this.colTotals={};this.allTotal=this.aggregator();this.sorted=!1}a.prototype.natSort=function(b,a){var e,h,f,d,p,l;h=/(\d+)|(\D+)/g;p=/\d/;l=/^0/;if("number"===typeof b||"number"===typeof a)return isNaN(b)?1:isNaN(a)?-1:b-a;e=String(b).toLowerCase();f=String(a).toLowerCase();if(e===f)return 0;if(!p.test(e)||!p.test(f))return e>f?1:-1;e=e.match(h);for(f=f.match(h);e.length&&f.length;)if(h=e.shift(),d=f.shift(),h!==d)return p.test(h)&&p.test(d)?h.replace(l,".0")-d.replace(l,".0"):h>d?1:-1;return e.length-
f.length};a.prototype.arrSort=function(b,a){return this.natSort(b.join(),a.join())};a.prototype.sortKeys=function(){this.sorted||(this.rowKeys.sort(this.arrSort),this.colKeys.sort(this.arrSort));return this.sorted=!0};a.prototype.getColKeys=function(){this.sortKeys();return this.colKeys};a.prototype.getRowKeys=function(){this.sortKeys();return this.rowKeys};a.prototype.flattenKey=function(b){return b.join(String.fromCharCode(0))};a.prototype.processRecord=function(b){var a,e,d,f,k;a=function(){var a,
e,c,d;c=this.colAttrs;d=[];a=0;for(e=c.length;a<e;a++)k=c[a],d.push(b[k]);return d}.call(this);f=function(){var a,e,c,d;c=this.rowAttrs;d=[];a=0;for(e=c.length;a<e;a++)k=c[a],d.push(b[k]);return d}.call(this);d=this.flattenKey(f);e=this.flattenKey(a);this.allTotal.push(b);0!==f.length&&(0>x.call(this.flatRowKeys,d)&&(this.rowKeys.push(f),this.flatRowKeys.push(d)),this.rowTotals[d]||(this.rowTotals[d]=this.aggregator()),this.rowTotals[d].push(b));0!==a.length&&(0>x.call(this.flatColKeys,e)&&(this.colKeys.push(a),
this.flatColKeys.push(e)),this.colTotals[e]||(this.colTotals[e]=this.aggregator()),this.colTotals[e].push(b));if(0!==a.length&&0!==f.length)return d in this.tree||(this.tree[d]={}),e in this.tree[d]||(this.tree[d][e]=this.aggregator()),this.tree[d][e].push(b)};a.prototype.getAggregator=function(a,c){var e,d;d=this.flattenKey(a);e=this.flattenKey(c);e=0===a.length&&0===c.length?this.allTotal:0===a.length?this.colTotals[e]:0===c.length?this.rowTotals[d]:this.tree[d][e];return null!=e?e:{value:function(){return null},
format:function(){return""}}};return a}();J=function(a,b,c,e,d,f){var k;k=new E(e,b,c);B(a,f,function(a){if(d(a))return k.processRecord(a)});return k};D=function(a,b,c){var e,d,f,k;if(0!==b){e=!0;for(f=d=0;0<=c?d<=c:d>=c;f=0<=c?++d:--d)a[b-1][f]!==a[b][f]&&(e=!1);if(e)return-1}for(e=0;b+e<a.length;){d=!1;for(f=k=0;0<=c?k<=c:k>=c;f=0<=c?++k:--k)a[b][f]!==a[b+e][f]&&(d=!0);if(d)break;e++}return e};u=function(a){var b,c,e,h,f,k,p,l,n,g,m;e=a.colAttrs;l=a.rowAttrs;n=a.getRowKeys();h=a.getColKeys();p=
d("<table class='table table-bordered pvtTable'>");for(k in e)if(r.call(e,k)){c=e[k];m=d("<tr>");0===parseInt(k)&&0!==l.length&&m.append(d("<th>").attr("colspan",l.length).attr("rowspan",e.length));m.append(d("<th class='pvtAxisLabel'>").text(c));for(f in h)r.call(h,f)&&(b=h[f],g=D(h,parseInt(f),parseInt(k)),-1!==g&&(g=d("<th class='pvtColLabel'>").text(b[k]).attr("colspan",g),parseInt(k)===e.length-1&&0!==l.length&&g.attr("rowspan",2),m.append(g)));0===parseInt(k)&&m.append(d("<th class='pvtTotalLabel'>").text("Totals").attr("rowspan",
e.length+(0===l.length?0:1)));p.append(m)}if(0!==l.length){m=d("<tr>");for(f in l)r.call(l,f)&&(c=l[f],m.append(d("<th class='pvtAxisLabel'>").text(c)));g=d("<th>");0===e.length&&g.addClass("pvtTotalLabel").text("Totals");m.append(g);p.append(m)}for(f in n)if(r.call(n,f)){c=n[f];m=d("<tr>");for(k in c)r.call(c,k)&&(b=c[k],g=D(n,parseInt(f),parseInt(k)),-1!==g&&(g=d("<th class='pvtRowLabel'>").text(b).attr("rowspan",g),parseInt(k)===l.length-1&&0!==e.length&&g.attr("colspan",2),m.append(g)));for(k in h)r.call(h,
k)&&(b=h[k],b=a.getAggregator(c,b),g=b.value(),m.append(d("<td class='pvtVal row"+f+" col"+k+"'>").text(b.format(g)).data("value",g)));c=a.getAggregator(c,[]);g=c.value();m.append(d("<td class='pvtTotal rowTotal'>").text(c.format(g)).data("value",g).data("for","row"+f));p.append(m)}m=d("<tr>");g=d("<th class='pvtTotalLabel'>").text("Totals");g.attr("colspan",l.length+(0===e.length?0:1));m.append(g);for(k in h)r.call(h,k)&&(b=h[k],c=a.getAggregator([],b),g=c.value(),m.append(d("<td class='pvtTotal colTotal'>").text(c.format(g)).data("value",
g).data("for","col"+k)));c=a.getAggregator([],[]);g=c.value();m.append(d("<td class='pvtGrandTotal'>").text(c.format(g)).data("value",g));p.append(m);p.data("dimensions",[n.length,h.length]);return p};d.fn.pivot=function(a,b){var c;c={cols:[],rows:[],filter:function(){return!0},aggregator:A.count(),derivedAttributes:{},renderer:u};b=d.extend(c,b);this.html(b.renderer(J(a,b.cols,b.rows,b.aggregator,b.filter,b.derivedAttributes)));return this};d.fn.pivotUI=function(a,b,c){var e,h,f,k,p,l,n,g,m,y,z,
q,s,t=this;null==c&&(c=!1);p={derivedAttributes:{},aggregators:A,renderers:C,hiddenAttributes:[],cols:[],rows:[],vals:[]};l=this.data("pivotUIOptions");g=null==l||c?d.extend(p,b):l;a=G(a);b=function(){var b,d;b=a[0];d=[];for(n in b)r.call(b,n)&&d.push(n);return d}();c=g.derivedAttributes;for(f in c)r.call(c,f)&&0>x.call(b,f)&&b.push(f);h={};f=0;for(c=b.length;f<c;f++)q=b[f],h[q]={};B(a,g.derivedAttributes,function(a){var b,d,c;c=[];for(n in a)r.call(a,n)&&(b=a[n],null==b&&(b="null"),null==(d=h[n])[b]&&
(d[b]=0),c.push(h[n][b]++));return c});c=d("<table class='table table-bordered' cellpadding='5'>");p=d("<td>");z=d("<select id='renderer'>").bind("change",function(){return y()});f=g.renderers;for(q in f)r.call(f,q)&&z.append(d("<option>").val(q).text(q));p.append(z);k=d("<td id='unused' class='pvtAxisContainer pvtHorizList'>");l=0;for(s=b.length;l<s;l++)f=b[l],0>x.call(g.hiddenAttributes,f)&&function(a){var b,c,e,f,g,m,l;b=Object.keys(h[a]).length;c=d("<nobr>").text(a);f=d("<div>").css({"z-index":100,
width:"280px",height:"350px",overflow:"scroll",border:"1px solid gray",background:"white",display:"none",position:"absolute",padding:"20px"});f.append(d("<strong>").text(""+b+" values for "+a));if(50<b)f.append(d("<p>").text("(too many to list)"));else for(b=d("<p>"),b.append(d("<button>").text("Select All").bind("click",function(){return f.find("input").attr("checked",!0)})),b.append(d("<button>").text("Select None").bind("click",function(){return f.find("input").attr("checked",!1)})),f.append(b),
l=Object.keys(h[a]).sort(),g=0,m=l.length;g<m;g++)n=l[g],e=h[a][n],b=d("<label>"),b.append(d("<input type='checkbox' class='pvtFilter'>").attr("checked",!0).data("filter",[a,n])),b.append(d("<span>").text(""+n+" ("+e+")")),f.append(d("<p>").append(b));c.bind("dblclick",function(a){f.css({left:a.pageX,top:a.pageY}).toggle();f.bind("click",function(a){return a.stopPropagation()});return d(document).one("click",function(){y();return f.toggle()})});return k.append(d("<li class='label label-info' id='axis_"+
a.replace(/\s/g,"")+"'>").append(c).append(f))}(f);c.append(d("<tr>").append(p).append(k));f=d("<tr>");e=d("<select id='aggregator'>").css("margin-bottom","5px").bind("change",function(){return y()});b=g.aggregators;for(q in b)r.call(b,q)&&e.append(d("<option>").val(q).text(q));f.append(d("<td id='vals' class='pvtAxisContainer pvtHorizList'>").css("text-align","center").append(e).append(d("<br>")));f.append(d("<td id='cols' class='pvtAxisContainer pvtHorizList'>"));c.append(f);q=d("<tr>");q.append(d("<td valign='top' id='rows' class='pvtAxisContainer'>"));
m=d("<td valign='top'>");q.append(m);c.append(q);this.html(c);c=g.cols;f=0;for(b=c.length;f<b;f++)q=c[f],d("#cols").append(d("#axis_"+q.replace(/\s/g,"")));c=g.rows;f=0;for(b=c.length;f<b;f++)q=c[f],d("#rows").append(d("#axis_"+q.replace(/\s/g,"")));c=g.vals;b=0;for(f=c.length;b<f;b++)q=c[b],d("#vals").append(d("#axis_"+q.replace(/\s/g,"")));null!=g.aggregatorName&&d("#aggregator").val(g.aggregatorName);null!=g.rendererName&&d("#renderer").val(g.rendererName);y=function(){var b,c,f;c={derivedAttributes:g.derivedAttributes,
cols:[],rows:[]};f=[];d("#rows li nobr").each(function(){return c.rows.push(d(this).text())});d("#cols li nobr").each(function(){return c.cols.push(d(this).text())});d("#vals li nobr").each(function(){return f.push(d(this).text())});c.aggregator=g.aggregators[e.val()](f);c.renderer=g.renderers[z.val()];b=[];d("input.pvtFilter").not(":checked").each(function(){return b.push(d(this).data("filter"))});c.filter=function(a){var c,d,e;e=0;for(d=b.length;e<d;e++)if(c=b[e],n=c[0],c=c[1],a[n]===c)return!1;
return!0};m.pivot(a,c);return t.data("pivotUIOptions",{cols:c.cols,rows:c.rows,vals:f,hiddenAttributes:g.hiddenAttributes,renderers:g.renderers,aggregators:g.aggregators,derivedAttributes:g.derivedAttributes,aggregatorName:e.val(),rendererName:z.val()})};y();d(".pvtAxisContainer").sortable({connectWith:".pvtAxisContainer",items:"li"}).bind("sortstop",y);return this};d.fn.heatmap=function(a){var b,c,e,h,f=this;null==a&&(a="heatmap");c=this.data("dimensions");h=c[0];e=c[1];b=function(a,b,c){var d;d=
function(){switch(a){case "red":return function(a){return"ff"+a+a};case "green":return function(a){return""+a+"ff"+a};case "blue":return function(a){return""+a+a+"ff"}}}();return function(a){a=(255-Math.round(255*(a-b)/(c-b))).toString(16).split(".")[0];1===a.length&&(a=0+a);return d(a)}};c=function(a,c){var e,h,g;h=function(b){return f.find(a).each(function(){var a;a=d(this).data("value");if(null!=a&&isFinite(a))return b(a,d(this))})};g=[];h(function(a){return g.push(a)});e=b(c,Math.min.apply(Math,
g),Math.max.apply(Math,g));return h(function(a,b){return b.css("background-color","#"+e(a))})};switch(a){case "heatmap":c(".pvtVal","red");break;case "rowheatmap":for(e=a=0;0<=h?a<h:a>h;e=0<=h?++a:--a)c(".pvtVal.row"+e,"red");break;case "colheatmap":for(h=a=0;0<=e?a<e:a>e;h=0<=e?++a:--a)c(".pvtVal.col"+h,"red")}c(".pvtTotal.rowTotal","red");c(".pvtTotal.colTotal","red");return this};d.fn.barchart=function(){var a,b,c,e,h=this;c=this.data("dimensions")[0];a=function(a){var b,c,e,n;b=function(b){return h.find(a).each(function(){var a;
a=d(this).data("value");if(null!=a&&isFinite(a))return b(a,d(this))})};n=[];b(function(a){return n.push(a)});c=Math.max.apply(Math,n);e=function(a){return 100*a/(1.4*c)};return b(function(a,b){var c,f;c=b.text();f=d("<div>").css({position:"relative",height:"55px"});f.append(d("<div>").css({position:"absolute",bottom:0,left:0,right:0,height:e(a)+"%","background-color":"gray"}));f.append(d("<div>").text(c).css({position:"relative","padding-left":"5px","padding-right":"5px"}));return b.css({padding:0,
"padding-top":"5px","text-align":"center"}).html(f)})};for(b=e=0;0<=c?e<c:e>c;b=0<=c?++e:--e)a(".pvtVal.row"+b);a(".pvtTotal.colTotal");return this}}).call(this);
//# sourceMappingURL=pivot.js.map
